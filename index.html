<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profil Sahifasi</title>

    <!-- Firebase Web SDK -->
    <script type="module">
        // Import the functions you need from the SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

        // TODO: replace with your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDVZ8UG4GJtrtbiv6dQqxMdZwZHf84XPHs",
            authDomain: "exemple-initdata-tg.firebaseapp.com",
            projectId: "exemple-initdata-tg",
            storageBucket: "exemple-initdata-tg.firebasestorage.app",
            messagingSenderId: "1091408606210",
            appId: "1:1091408606210:web:93bb427cca8c616962a31b",
            measurementId: "G-4P9ZHGDH7C"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.firebaseDB = db; // globally access in other scripts
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            transition: background 0.3s, color 0.3s;
        }

        body.light {
            background: #f5f5f5;
            color: #111;
        }

        body.dark {
            background: #0d1117;
            color: #fff;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .profile {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile div h1 {
            margin: 0;
            font-size: 22px;
        }

        .profile div p {
            margin: 2px 0;
            font-size: 16px;
        }

        section {
            margin-top: 30px;
        }

        h2 {
            margin-bottom: 10px;
        }

        .dark-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 10px 15px;
            background: #2583ff;
            border: none;
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
        }

        button:active {
            opacity: 0.8;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        ul li {
            padding: 5px 0;
            border-bottom: 1px solid gray;
        }
    </style>
</head>

<body class="light">
    <div class="container">
        <!-- Profil boâ€˜limi -->
        <div class="profile">
            <img id="userPhoto" src="https://via.placeholder.com/80" alt="Foto">
            <div>
                <h1 id="userName">Loading...</h1>
                <p id="userUsername"></p>
                <p id="userPhone"></p>
            </div>
        </div>

        <!-- Buyurtmalar Tarixi -->
        <section>
            <h2>ðŸ“œ Buyurtmalar Tarixi</h2>
            <ul id="orderHistory">
                <li>Yuklanmoqda...</li>
            </ul>
        </section>

        <!-- Yordam boâ€˜limi -->
        <section>
            <h2>ðŸ†˜ Yordam</h2>
            <p>Har qanday savol boâ€˜lsa, biz bilan bogâ€˜laning: support@example.com</p>
        </section>

        <!-- Dark / Light Mode -->
        <div class="dark-toggle">
            <input type="checkbox" id="themeToggle">
            <label for="themeToggle">ðŸŒ™ Dark Mode</label>
        </div>
    </div>

    <script type="module">
        import { doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

        const db = window.firebaseDB;

        async function initProfile() {
            const userId = Telegram.WebApp.initDataUnsafe?.user?.id;
            if (!userId) return;

            // Firestore dan telefon va boshqa info olish
            const userDoc = await getDoc(doc(db, "users", userId.toString()));
            let phone = "(telefon topilmadi)";
            if (userDoc.exists()) {
                phone = userDoc.data().phone || phone;
            }

            // Telegram info
            const user = Telegram.WebApp.initDataUnsafe.user || {};
            document.getElementById("userPhoto").src = user.photo_url || "https://via.placeholder.com/80";
            document.getElementById("userName").textContent = `${user.first_name || ""} ${user.last_name || ""}`.trim();
            document.getElementById("userUsername").textContent = user.username ? "@" + user.username : "(username mavjud emas)";
            document.getElementById("userPhone").textContent = "ðŸ“± " + phone;

            // Buyurtmalar tarixi (misol)
            const ordersCol = collection(db, "orders");
            const ordersSnap = await getDocs(ordersCol);
            const ordersList = document.getElementById("orderHistory");
            ordersList.innerHTML = "";
            ordersSnap.forEach(doc => {
                const li = document.createElement("li");
                li.textContent = `Order #${doc.id}: ${doc.data().item || "Mahsulot"} - ${doc.data().status || "Holati noma'lum"}`;
                ordersList.appendChild(li);
            });
        }

        initProfile();

        // Dark / Light Mode
        const toggle = document.getElementById("themeToggle");
        toggle.addEventListener("change", () => {
            if (toggle.checked) {
                document.body.classList.remove("light");
                document.body.classList.add("dark");
            } else {
                document.body.classList.remove("dark");
                document.body.classList.add("light");
            }
        });
    </script>

    <!-- Telegram JS SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</body>

</html>